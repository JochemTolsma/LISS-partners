---
  title: "LISS-Partners"
author: '[Jochem Tolsma](https://www.jochemtolsma.nl) - Radboud University, the Netherlands'
bibliography: references.bib
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
output: 
  html_document:
  toc:  true
toc_float: true
number_sections: false
code_folding: show
code_download: yes
---
  
```{r, globalsettings, echo=FALSE, warning=FALSE}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()


colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
            x)
  } else x
}

```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

```{css, echo=FALSE}
pre.test {
  max-height: 300px;
  overflow-y: auto;
  overflow-x: auto;
  margin: 0px;
}

pre.test2 {
  max-height: 300px;
  overflow-y: auto;
  overflow-x: auto;
  margin: 0px;
  background-color: white
}


h1, .h1, h2, .h2, h3, .h3 {
  margin-top: 24px;
}


```

----
  
This website is a replication package for the paper "LISS-partners" by @Jeroense2021. It contains R code to replicate all Tables in the manuscript. 

Use the top menu to navigate to the section of interest. The section replicates the **Main Tables** of the manuscript. 

To copy the code click the button in the upper right corner of the code-chunks. 


----
  
```{r packages, class.source="watch-out"}
#load packages.
library(dplyr)
library(haven)
library(purrr)
library(tidyr)
library(lavaan)
```


## Data
All data and scripts can be found on [Github](https://github.com/JochemTolsma/LISS-partners)

----
  
## Contact
Questions can be addressed to the first author of the corresponding article, [Thijmen Jeroense](mailto:thijmen.jeroense@ru.nl). 

----  
  
## Data  
  
```{r, export and cleaning}
#clean the environment. 
rm(list=ls())


load('data-processed/partner_dataprepped.Rdata')
table(partner_df_wide$geslacht.m.1, partner_df_wide$geslacht.f.1, useNA="always")

```

### Description of the data

The *partner_dataprepped_v1_210209.Rdata* consists of the prepped data for the partner paper, in long and wide format. For now, I have only included a selection of variables.  

- The suffices **.m** and **.f** denote the gender of the partner within the heterosexual couples (male, female)  
- .x, where x is a number, denotes the wave in the wide format.  

Variables of interest and value labels:
  
  - nohouse_encr = hh id
- nomem_encr = respondent/partner id
- oplmet = higheste completed education in years
- geslacht = dummy with 0 = male / 1 = female
- eu_integration = 0 = eu integration has gone too far / 4 = eu integration should go further
- immigrants = 0 = immigrants should adjust / 4 immigrants can retain their own culture.


---  
  
## CLPM
  
### two waves
  
```{r}

myModel <- "
  # Estimate the lagged effects
  eu_integration.m.2 ~ eu_integration.m.1 + eu_integration.f.1
  eu_integration.f.2 ~ eu_integration.f.1 + eu_integration.m.1
  
  # Estimate the covariance at the first wave. 
  eu_integration.m.1 ~~ eu_integration.f.1 # Covariance

  # Estimate the residual covariance
  eu_integration.m.2 ~~ eu_integration.f.2 
  
  # Estimate the variance 
  eu_integration.m.1 ~~ eu_integration.m.1 
  eu_integration.f.1 ~~ eu_integration.f.1 
  
  # Estimate the residual variance
  eu_integration.m.2 ~~ eu_integration.m.2 
  eu_integration.f.2 ~~ eu_integration.f.2 
  
  # intercepts
  eu_integration.m.1 ~ 1
  eu_integration.f.1~ 1
  eu_integration.m.2 ~ 1
  eu_integration.f.2 ~ 1
"



fit <- lavaan(myModel, data = partner_df_wide, missing = "ML", meanstructure = T)
summary(fit, standardized = T)
```
### six waves

```{r}

myModel <- "
  ### Estimate the lagged effects
  eu_integration.m.2 ~ a*eu_integration.m.1 + b*eu_integration.f.1
  eu_integration.f.2 ~ c*eu_integration.f.1 + d*eu_integration.m.1
  
  eu_integration.m.3 ~ a*eu_integration.m.2 + b*eu_integration.f.2
  eu_integration.f.3 ~ c*eu_integration.f.2 + d*eu_integration.m.2
  
  eu_integration.m.4 ~ a*eu_integration.m.3 + b*eu_integration.f.3
  eu_integration.f.4 ~ c*eu_integration.f.3 + d*eu_integration.m.3
  
  eu_integration.m.5 ~ a*eu_integration.m.4 + b*eu_integration.f.4
  eu_integration.f.5 ~ c*eu_integration.f.4 + d*eu_integration.m.4
  
  eu_integration.m.6 ~ a*eu_integration.m.5 + b*eu_integration.f.5
  eu_integration.f.6 ~ c*eu_integration.f.5 + d*eu_integration.m.5
  
  ### Estimate the covariance at the first wave. 
  eu_integration.m.1 ~~ eu_integration.f.1 # Covariance
  
  # Estimate the variance at the first wave
  eu_integration.m.1 ~~ eu_integration.m.1 
  eu_integration.f.1 ~~ eu_integration.f.1 

  ### Estimate the residual covariance
  eu_integration.m.2 ~~ eu_integration.f.2
  eu_integration.m.3 ~~ eu_integration.f.3 
  eu_integration.m.4 ~~ eu_integration.f.4 
  eu_integration.m.5 ~~ eu_integration.f.5 
  eu_integration.m.6 ~~ eu_integration.f.6 
  
  # Estimate the residual variance
  eu_integration.m.2 ~~ eu_integration.m.2 
  eu_integration.f.2 ~~ eu_integration.f.2 
  eu_integration.m.3 ~~ eu_integration.m.3 
  eu_integration.f.3 ~~ eu_integration.f.3 
  eu_integration.m.4 ~~ eu_integration.m.4 
  eu_integration.f.4 ~~ eu_integration.f.4 
  eu_integration.m.5 ~~ eu_integration.m.5 
  eu_integration.f.5 ~~ eu_integration.f.5 
  eu_integration.m.6 ~~ eu_integration.m.6 
  eu_integration.f.6 ~~ eu_integration.f.6 
  
  # intercepts
  eu_integration.m.1 ~ 1
  eu_integration.f.1 ~ 1
  eu_integration.m.2 ~ 1
  eu_integration.f.2 ~ 1
  eu_integration.m.3 ~ 1
  eu_integration.f.3 ~ 1
  eu_integration.m.4 ~ 1
  eu_integration.f.4 ~ 1
  eu_integration.m.5 ~ 1
  eu_integration.f.5 ~ 1
  eu_integration.m.6 ~ 1
  eu_integration.f.6 ~ 1
  
"



fit <- lavaan(myModel, data = partner_df_wide, missing = "ml", meanstructure = T)
summary(fit, standardized = T)
```

---  
  
## RI-CLPM {.tabset .tabset-fade}
  
Met de originele data krijg ik onverklaarbare problemen met de namen van de dataset. Dus dan maar deze detour. 



```{r}
dat <- data.frame(x1=partner_df_wide$eu_integration.m.1)
dat$x2 <- partner_df_wide$eu_integration.m.2
dat$x3 <- partner_df_wide$eu_integration.m.3
dat$x4 <- partner_df_wide$eu_integration.m.4
dat$x5 <- partner_df_wide$eu_integration.m.5
dat$y1 <- partner_df_wide$eu_integration.f.1
dat$y2 <- partner_df_wide$eu_integration.f.2
dat$y3 <- partner_df_wide$eu_integration.f.3
dat$y4 <- partner_df_wide$eu_integration.f.4
dat$y5 <- partner_df_wide$eu_integration.f.5

selectie <- !rowSums(is.na(dat))==10 #lege cases identificeren
dat$oplx <- partner_df_wide$oplmet.m.1
dat$oply <- partner_df_wide$oplmet.f.1

dat <- dat[selectie,]

```

### RI-model 

```{r}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5
  
  RIx ~ oplx
  RIy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wy2 ~ c*wx1 + d*wy1
  wy3 ~ c*wx2 + d*wy2
  wy4 ~ c*wx3 + d*wy3
  wy5 ~ c*wx4 + d*wy4

  # Estimate the covariance between the within-person centered variables at the first wave. 
  wx1 ~~ wy1 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations).
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
'
RICLPM.fit <- lavaan(RICLPM, data = dat, missing = 'ml.x', meanstructure = T, int.ov.free = T) 
summary(RICLPM.fit, standardized = T)
```


### structural change -model 

```{r}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + x2 + x3 + x4 + x5
  RIy =~ 1*y1 + y2 + y3 + y4 + y5
  
  RIx ~ oplx
  RIy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wy2 ~ c*wx1 + d*wy1
  wy3 ~ c*wx2 + d*wy2
  wy4 ~ c*wx3 + d*wy3
  wy5 ~ c*wx4 + d*wy4

  # Estimate the covariance between the within-person centered variables at the first wave. 
  wx1 ~~ wy1 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations).
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
'
RICLPM.fit <- lavaan(RICLPM, data = dat, missing = 'ml.x', meanstructure = T, int.ov.free = T) 
summary(RICLPM.fit, standardized = T)
```

### select on couples who disagree 

```{r}
hist(dat$x1-dat$y1)
table(dat$x1-dat$y1, useNA="always")

#dat$x1-dat$y1
dat_sel <- dat[abs(dat$x1-dat$y1)>1 & !is.na(dat$x1-dat$y1),]

RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5
  
  RIx ~ oplx
  RIy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wy2 ~ c*wx1 + d*wy1
  wy3 ~ c*wx2 + d*wy2
  wy4 ~ c*wx3 + d*wy3
  wy5 ~ c*wx4 + d*wy4

  # Estimate the covariance between the within-person centered variables at the first wave. 
  wx1 ~~ wy1 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations).
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
'
RICLPM.fit <- lavaan(RICLPM, data = dat_sel, missing = 'ml.x', meanstructure = T, int.ov.free = T) 
summary(RICLPM.fit, standardized = T)
```


## Table 1 {.tabset .tabset-fade}

### part1 

```{r, results="hold"}
```

---  
  
  
### part2
  
  
  
---  
  
  