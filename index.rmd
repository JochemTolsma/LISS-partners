---
title: "Partners and Politics"
author: '[Jochem Tolsma](https://www.jochemtolsma.nl) - Radboud University / University of Groningen, the Netherlands'
bibliography: references.bib
date: "Last compiled on `r format(Sys.time(), '%B, %Y')`"
output: 
  html_document:
    toc:  true
    toc_float: true
    number_sections: false
    code_folding: show
    code_download: yes
---

```{r globalsettings, echo=FALSE, warning=FALSE}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=100),tidy=TRUE, warning = FALSE, message = FALSE,comment = "#>", cache=TRUE, class.source=c("test"), class.output=c("test2"))
options(width = 100)
rgl::setupKnitr()
```

```{r colorize, echo=FALSE}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
            x)
  } else x
}

```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'))
#klippy::klippy(color = 'darkred')
#klippy::klippy(tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

```{css, echo=FALSE}
pre.test {
  max-height: 300px;
  overflow-y: auto;
  overflow-x: auto;
  margin: 0px;
}

pre.test2 {
  max-height: 300px;
  overflow-y: auto;
  overflow-x: auto;
  margin: 0px;
  background-color: white;
  color: rgb(201, 76, 76);
}


h1, .h1, h2, .h2, h3, .h3 {
  margin-top: 24px;
}


```

```{r packages, echo=FALSE}
#install if necessary 
if (!require("dplyr", character.only = TRUE)) {install.packages("dplyr", dependencies=TRUE)}
if (!require("haven", character.only = TRUE)) {install.packages("haven", dependencies=TRUE)}
#if (!require("purr", character.only = TRUE)) {install.packages("purr", dependencies=TRUE)}
if (!require("lavaan", character.only = TRUE)) {install.packages("lavaan", dependencies=TRUE)}

#load packages.
library(dplyr)
library(haven)
library(purrr)
library(tidyr)
library(lavaan)

```

------------------------------------------------------------------------


This website is a replication package for the paper "LISS-partners" by @Tolsma2021.

It contains R code to replicate all Tables/Results in the manuscript.

To copy the code click the button in the upper right corner of the code-chunks.

Use the top menu to navigate to the section of interest. 

The source code of this website can be found on [Github](https://github.com/JochemTolsma/LISS-partners)

This section replicates the [**Presentation at DvdS 2021**](https://www.nsv-sociologie.nl/?page_id=3218).

Questions can be addressed to [Jochem Tolsma](mailto:jochem.tolsma@ru.nl).

---  



## Introduction {.tabset .tabset-fade}

<html>
<body>
</iframe>
<a id='LuHtIfAxRu5Ma_5cwLSW1g' class='gie-single' href='http://www.gettyimages.nl/detail/153360657' target='_blank' style='color:#a7a7a7;text-decoration:none;font-weight:normal !important;border:none;display:inline-block;'>Embed from Getty Images</a><script>window.gie=window.gie||function(c){(gie.q=gie.q||[]).push(c)};gie(function(){gie.widgets.load({id:'LuHtIfAxRu5Ma_5cwLSW1g',sig:'1lfLuUoX5Pth1-d8wRyeRSQhCC9Ov2SK_l9qlSdR5X8=',w:'507px',h:'338px',items:'153360657',caption: true ,tld:'nl',is360: false })});</script><script src='//embed-cdn.gettyimages.com/widgets.js' charset='utf-8' async></script>
</body>
</html>

---   

Starting point: opinion homophily within couples. 

Homophily may be the result of: 

- **selection**  
- **common context** 
- **influence**  
-

---  

### Selection  

Marriage Market: Constrained Decisions with whom to marry (or cohabit). 

---  

### Common context  

- Shared live events:  
  - having kids  
  - poverty  
- Shared environment:
  - polution
  - housing
  - poverty 


---  

### Influence  

- Pictures of convergence / divergence 
- Dyadic (positive) influence:  
  - information  
  - persuasion  
  - need for similarity  
  
---  

## Expectations {.tabset .tabset-fade} 


"People influence one another, and as the importance and immediacy of a group or individual increases, this influence becomes stronger (Latan√©, 1981). Forces of influence are especially strong within romantic relationships because these relationships are important, are predicated on mutual acceptance, and involve frequent exposure to the habits of one's partner." @bartel2017romantic
---  

### Hypothesis 1 



Naive conceptualisation of **influence**. It is assumed that partners will match their opinions/behaviors. Thus influence here is convergence. 

**Hypo1: Partner influence hypothesis** 

Hypo1 CLPM: When men have a relatively high opinion (compared to the grand mean opinion of men over time) at time T, men's spouses will have a relatively high opinion (compared to the grand mean opinion of women over time) at time T+1, and vice versa. 

**Hypo1 RI-CLPM: When your partner's opinion is relatively high (compared to your partners average opinion over time) at time T, your own opinion will be relatively high (compared to your own average opinion over time) at time T+1.** 

Hypo1 SC-RI-CLPM: Even if we control for structural time trends in political opinions, when your partner's opinion is relatively high (compared to your partners average opinion over time) at time T, your own opinion will be relatively high (compared to your own average opinion over time) at time T+1. 

Hypo1 LT-RI-CLPM: Even if we take into account that...: 
  - the general time trend of men and women will be (positively) associated (i.e. positive covariance of the random slopes);  
  - the mean opinion of your spouse will influence your general time trend (i.e. negative covariance of random intercept of men with random slop of women (and vice versa));
  ...when your partner's opinion is relatively high (compared to your partners average opinion over time) at time T, your own opinion will be relatively high (compared to your own average opinion over time) at time T+1. 



---  

### Hypo2

---  

### Hypo3

---  


## Data {.tabset .tabset-fade}

- LISS  
- 11 waves  
- More than 3000 heterosexual couples (cohabiting and married)

---  

### LISS Modules

--- 

### Variables  

Variables of interest and value labels:

-   nohouse_encr = hh id
-   nomem_encr = respondent/partner id
-   oplmet = higheste completed education in years
-   geslacht = dummy with 0 = male / 1 = female
-   eu_integratrion = 0 = eu integration has gone too far / 4 = eu integration should go further
-   immigrants = 0 = immigrants should adjust / 4 immigrants can retain their own culture.
-   euthanasia = 1 = euthanasia should be forbidden / 5 euthanasia should be permitted
-   income_diff = 1 differences in income should increase / differences in income should decrease

---  

### Descriptives

---  


```{r, echo=FALSE}
#clean the environment. 
rm(list=ls())
load('data-processed/partner_dataprepped.Rdata')

partner_df_wide <- reshape(partner_df_long,
                           direction = 'wide',
                           v.names = names(partner_df_long[2,4:22]),
                           idvar = 'nohouse_encr',
                           timevar = 'time')


```

### Description of the data

The *partner_dataprepped_v1_210209.Rdata* consists of the prepped data for the partner paper, in long and wide format. For now, I have only included a selection of variables.

-   The suffices **.m** and **.f** denote the gender of the partner within the heterosexual couples (male, female)\
-   .x, where x is a number, denotes the wave in the wide format.




```{r, echo=FALSE, results='hide'}
datalist <- list()
datalist_ori <- list()

# eu_integration

dat <- data.frame(x1=partner_df_wide$eu_integration.m.1)
dat$x2 <- partner_df_wide$eu_integration.m.2
dat$x3 <- partner_df_wide$eu_integration.m.3
dat$x4 <- partner_df_wide$eu_integration.m.4
dat$x5 <- partner_df_wide$eu_integration.m.5
dat$x6 <- partner_df_wide$eu_integration.m.6
dat$x7 <- partner_df_wide$eu_integration.m.7
dat$x8 <- partner_df_wide$eu_integration.m.8
dat$x9 <- partner_df_wide$eu_integration.m.9
dat$x10 <- partner_df_wide$eu_integration.m.10
dat$x11 <- partner_df_wide$eu_integration.m.11

dat$y1 <- partner_df_wide$eu_integration.f.1
dat$y2 <- partner_df_wide$eu_integration.f.2
dat$y3 <- partner_df_wide$eu_integration.f.3
dat$y4 <- partner_df_wide$eu_integration.f.4
dat$y5 <- partner_df_wide$eu_integration.f.5
dat$y6 <- partner_df_wide$eu_integration.f.6
dat$y7 <- partner_df_wide$eu_integration.f.7
dat$y8 <- partner_df_wide$eu_integration.f.8
dat$y9 <- partner_df_wide$eu_integration.f.9
dat$y10 <- partner_df_wide$eu_integration.f.10
dat$y11 <- partner_df_wide$eu_integration.f.11

#treat education as a time stable. And use all available data. 
dat$oplx <- rowMeans(partner_df_wide[,c("oplmet.m.1", "oplmet.m.2",  "oplmet.m.3", "oplmet.m.4", "oplmet.m.5", "oplmet.m.6", "oplmet.m.7",  "oplmet.m.8", "oplmet.m.9", "oplmet.m.10", "oplmet.m.11")], na.rm=T)
dat$oply <- rowMeans(partner_df_wide[,c("oplmet.f.1", "oplmet.f.2",  "oplmet.f.3", "oplmet.f.4", "oplmet.f.5", "oplmet.f.6", "oplmet.f.7",  "oplmet.f.8", "oplmet.f.9", "oplmet.f.10", "oplmet.f.11")], na.rm=T)

#calculate diff in education between men and women
dat$oplxy <- dat$oplx - dat$oply
#table(dat$oplx, dat$oply, useNA = "always")
#hist(dat$oplxy)

#define three groups for multigroup analyses
dat$oplgroup <- ifelse(dat$oplxy > 1, "menhigher", NA)
dat$oplgroup <- ifelse(dat$oplxy < -1, "womenhigher", dat$oplgroup)
dat$oplgroup <- ifelse(dat$oplxy <= 1 & dat$oplxy >= -1, "equal", dat$oplgroup)
#table(dat$oplgroup, useNA = "always")

dat_ori <- dat
selectie <- rowSums(is.na(dat_ori[,1:12])) < 8 # bijna lege cases identificeren
dat <- dat_ori[selectie,]

datalist_ori[[1]] <- dat_ori
datalist[[1]] <- dat


# immigrants

dat <- data.frame(x1=partner_df_wide$immigrants.m.1)
dat$x2 <- partner_df_wide$immigrants.m.2
dat$x3 <- partner_df_wide$immigrants.m.3
dat$x4 <- partner_df_wide$immigrants.m.4
dat$x5 <- partner_df_wide$immigrants.m.5
dat$x6 <- partner_df_wide$immigrants.m.6
dat$x7 <- partner_df_wide$immigrants.m.7
dat$x8 <- partner_df_wide$immigrants.m.8
dat$x9 <- partner_df_wide$immigrants.m.9
dat$x10 <- partner_df_wide$immigrants.m.10
dat$x11 <- partner_df_wide$immigrants.m.11

dat$y1 <- partner_df_wide$immigrants.f.1
dat$y2 <- partner_df_wide$immigrants.f.2
dat$y3 <- partner_df_wide$immigrants.f.3
dat$y4 <- partner_df_wide$immigrants.f.4
dat$y5 <- partner_df_wide$immigrants.f.5
dat$y6 <- partner_df_wide$immigrants.f.6
dat$y7 <- partner_df_wide$immigrants.f.7
dat$y8 <- partner_df_wide$immigrants.f.8
dat$y9 <- partner_df_wide$immigrants.f.9
dat$y10 <- partner_df_wide$immigrants.f.10
dat$y11 <- partner_df_wide$immigrants.f.11

#treat education as a time stable. And use all available data. 
dat$oplx <- rowMeans(partner_df_wide[,c("oplmet.m.1", "oplmet.m.2",  "oplmet.m.3", "oplmet.m.4", "oplmet.m.5", "oplmet.m.6", "oplmet.m.7",  "oplmet.m.8", "oplmet.m.9", "oplmet.m.10", "oplmet.m.11")], na.rm=T)
dat$oply <- rowMeans(partner_df_wide[,c("oplmet.f.1", "oplmet.f.2",  "oplmet.f.3", "oplmet.f.4", "oplmet.f.5", "oplmet.f.6", "oplmet.f.7",  "oplmet.f.8", "oplmet.f.9", "oplmet.f.10", "oplmet.f.11")], na.rm=T)

#calculate diff in education between men and women
dat$oplxy <- dat$oplx - dat$oply
#table(dat$oplx, dat$oply, useNA = "always")
#hist(dat$oplxy)

#define three groups for multigroup analyses
dat$oplgroup <- ifelse(dat$oplxy > 1, "menhigher", NA)
dat$oplgroup <- ifelse(dat$oplxy < -1, "womenhigher", dat$oplgroup)
dat$oplgroup <- ifelse(dat$oplxy <= 1 & dat$oplxy >= -1, "equal", dat$oplgroup)
#table(dat$oplgroup, useNA = "always")

dat_ori <- dat
selectie <- rowSums(is.na(dat_ori[,1:12])) < 8 # bijna lege cases identificeren
dat <- dat_ori[selectie,]

datalist_ori[[2]] <- dat_ori
datalist[[2]] <- dat


# euthanasia

dat <- data.frame(x1=partner_df_wide$euthanasia.m.1)
dat$x2 <- partner_df_wide$euthanasia.m.2
dat$x3 <- partner_df_wide$euthanasia.m.3
dat$x4 <- partner_df_wide$euthanasia.m.4
dat$x5 <- partner_df_wide$euthanasia.m.5
dat$x6 <- partner_df_wide$euthanasia.m.6
dat$x7 <- partner_df_wide$euthanasia.m.7
dat$x8 <- partner_df_wide$euthanasia.m.8
dat$x9 <- partner_df_wide$euthanasia.m.9
dat$x10 <- partner_df_wide$euthanasia.m.10
dat$x11 <- partner_df_wide$euthanasia.m.11

dat$y1 <- partner_df_wide$euthanasia.f.1
dat$y2 <- partner_df_wide$euthanasia.f.2
dat$y3 <- partner_df_wide$euthanasia.f.3
dat$y4 <- partner_df_wide$euthanasia.f.4
dat$y5 <- partner_df_wide$euthanasia.f.5
dat$y6 <- partner_df_wide$euthanasia.f.6
dat$y7 <- partner_df_wide$euthanasia.f.7
dat$y8 <- partner_df_wide$euthanasia.f.8
dat$y9 <- partner_df_wide$euthanasia.f.9
dat$y10 <- partner_df_wide$euthanasia.f.10
dat$y11 <- partner_df_wide$euthanasia.f.11

#treat education as a time stable. And use all available data. 
dat$oplx <- rowMeans(partner_df_wide[,c("oplmet.m.1", "oplmet.m.2",  "oplmet.m.3", "oplmet.m.4", "oplmet.m.5", "oplmet.m.6", "oplmet.m.7",  "oplmet.m.8", "oplmet.m.9", "oplmet.m.10", "oplmet.m.11")], na.rm=T)
dat$oply <- rowMeans(partner_df_wide[,c("oplmet.f.1", "oplmet.f.2",  "oplmet.f.3", "oplmet.f.4", "oplmet.f.5", "oplmet.f.6", "oplmet.f.7",  "oplmet.f.8", "oplmet.f.9", "oplmet.f.10", "oplmet.f.11")], na.rm=T)

#calculate diff in education between men and women
dat$oplxy <- dat$oplx - dat$oply
#table(dat$oplx, dat$oply, useNA = "always")
#hist(dat$oplxy)

#define three groups for multigroup analyses
dat$oplgroup <- ifelse(dat$oplxy > 1, "menhigher", NA)
dat$oplgroup <- ifelse(dat$oplxy < -1, "womenhigher", dat$oplgroup)
dat$oplgroup <- ifelse(dat$oplxy <= 1 & dat$oplxy >= -1, "equal", dat$oplgroup)
#table(dat$oplgroup, useNA = "always")

dat_ori <- dat
selectie <- rowSums(is.na(dat_ori[,1:12])) < 8 # bijna lege cases identificeren
dat <- dat_ori[selectie,]

datalist_ori[[3]] <- dat_ori
datalist[[3]] <- dat


# income_diff

dat <- data.frame(x1=partner_df_wide$income_diff.m.1)
dat$x2 <- partner_df_wide$income_diff.m.2
dat$x3 <- partner_df_wide$income_diff.m.3
dat$x4 <- partner_df_wide$income_diff.m.4
dat$x5 <- partner_df_wide$income_diff.m.5
dat$x6 <- partner_df_wide$income_diff.m.6
dat$x7 <- partner_df_wide$income_diff.m.7
dat$x8 <- partner_df_wide$income_diff.m.8
dat$x9 <- partner_df_wide$income_diff.m.9
dat$x10 <- partner_df_wide$income_diff.m.10
dat$x11 <- partner_df_wide$income_diff.m.11

dat$y1 <- partner_df_wide$income_diff.f.1
dat$y2 <- partner_df_wide$income_diff.f.2
dat$y3 <- partner_df_wide$income_diff.f.3
dat$y4 <- partner_df_wide$income_diff.f.4
dat$y5 <- partner_df_wide$income_diff.f.5
dat$y6 <- partner_df_wide$income_diff.f.6
dat$y7 <- partner_df_wide$income_diff.f.7
dat$y8 <- partner_df_wide$income_diff.f.8
dat$y9 <- partner_df_wide$income_diff.f.9
dat$y10 <- partner_df_wide$income_diff.f.10
dat$y11 <- partner_df_wide$income_diff.f.11

#treat education as a time stable. And use all available data. 
dat$oplx <- rowMeans(partner_df_wide[,c("oplmet.m.1", "oplmet.m.2",  "oplmet.m.3", "oplmet.m.4", "oplmet.m.5", "oplmet.m.6", "oplmet.m.7",  "oplmet.m.8", "oplmet.m.9", "oplmet.m.10", "oplmet.m.11")], na.rm=T)
dat$oply <- rowMeans(partner_df_wide[,c("oplmet.f.1", "oplmet.f.2",  "oplmet.f.3", "oplmet.f.4", "oplmet.f.5", "oplmet.f.6", "oplmet.f.7",  "oplmet.f.8", "oplmet.f.9", "oplmet.f.10", "oplmet.f.11")], na.rm=T)

#calculate diff in education between men and women
dat$oplxy <- dat$oplx - dat$oply
#table(dat$oplx, dat$oply, useNA = "always")
#hist(dat$oplxy)

#define three groups for multigroup analyses
dat$oplgroup <- ifelse(dat$oplxy > 1, "menhigher", NA)
dat$oplgroup <- ifelse(dat$oplxy < -1, "womenhigher", dat$oplgroup)
dat$oplgroup <- ifelse(dat$oplxy <= 1 & dat$oplxy >= -1, "equal", dat$oplgroup)
#table(dat$oplgroup, useNA = "always")

dat_ori <- dat
selectie <- rowSums(is.na(dat_ori[,1:12])) < 8 # bijna lege cases identificeren
dat <- dat_ori[selectie,]

datalist_ori[[4]] <- dat_ori
datalist[[4]] <- dat

table(partner_df_long$oplmet.f, useNA = 'always')
table(partner_df_long$oplmet.m, useNA = 'always')

#check the missings on education. 

#create a new df.
#select respondents that have a missing on either education of male or female or both partners. 
educ_na <- partner_df_long %>%
  filter(is.na(oplmet.m) | is.na(oplmet.f))

#in the long file there are 914 missings.

#check the number of unique households.
head(educ_na, 100)
unique(educ_na$nohouse_encr)

#so in the wide file there are around 185 with at least one missing on education. This is probably more so when we only want complete education observations. So let's check that.
partner_df_wide <- partner_df_wide %>%
  select(contains("oplmet.")) %>%
  rowwise() %>%
  mutate(na_check = sum(is.na(c(oplmet.m.1, oplmet.m.2, oplmet.m.3, oplmet.m.4, oplmet.m.5, oplmet.m.6, oplmet.m.7, oplmet.m.8, oplmet.m.9, oplmet.m.10, oplmet.m.11,oplmet.f.1, oplmet.f.2, oplmet.f.3, oplmet.f.4, oplmet.f.5, oplmet.f.6, oplmet.f.7, oplmet.f.8, oplmet.f.9, oplmet.f.10, oplmet.f.11 )))) %>%
  ungroup()

#so, now we are at the core of the problem. Only of 745 households do we have complete data. I'm not really suprised by it, in most panel data this is the case. Still, I can try to increase this number. 
table(partner_df_wide$na_check)

```

------------------------------------------------------------------------

## Modelling strategy {.tabset .tabset-fade}

Actor effects: stability effects
Partner effects: influence effects 

-   We will compare the results across four different modeling strategies:
    -   Cross-lagged Panel Model (CLPM) (11 waves)\
    -   **RI-CLPM (11 waves)**\
    -   RI-CLPM + structural time trends (11 waves)
    -   RI/RS-CLPM (11 waves)


-   We will test our hypotheses for three different dependent variables:

    -   eu-integration\
    -   immigration\
    -   euthanasia\

-   We will test our hypotheses among different (sub)samples of the LISS:

    -   **total**\
    -   couples among which initial opinion differs substantially\




In **bold face** above refers to the 'base line' which we will describe in detail in the paper.\
Our hypotheses refers to how the attitude of partner/alter at time T is related to the attitude of the other partern/ego at time T+1.

------------------------------------------------------------------------

## Results Hypo1 {.tabset .tabset-fade}



### CLPM
<!---
`r colorize("DONT FORGET TO SOLVE THE FITTING PROBLEMS", "red")`\
Changing optimizer seems to help a bit. Need to check what happens if we use all 11 waves.

-   We assume similar effect for men and women.\
-   We assume time-constant effects.\
-   We assume no structural changes (time trends).
--->

```{r}
results <- list()

myModel <- "
  ### control for education
  x1 + x2 + x3 +x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11 ~ e*oplx
  y1 + y2 + y3 +y4 + y5 + y6 + y7 + y8 + y9 + y10 + y11 ~ e*oply
  
  ### Estimate the lagged effects
  x2 ~ a*x1 + b*y1
  x3 ~ a*x2 + b*y2
  x4 ~ a*x3 + b*y3
  x5 ~ a*x4 + b*y4
  x6 ~ a*x5 + b*y5
  x7 ~ a*x6 + b*y6
  x8 ~ a*x7 + b*y7
  x9 ~ a*x8 + b*y8
  x10 ~ a*x9 + b*y9
  x11 ~ a*x10 + b*y10
  
  y2 ~ b*x1 + a*y1
  y3 ~ b*x2 + a*y2
  y4 ~ b*x3 + a*y3
  y5 ~ b*x4 + a*y4
  y6 ~ b*x5 + a*y5
  y7 ~ b*x6 + a*y6
  y8 ~ b*x7 + a*y7
  y9 ~ b*x8 + a*y8
  y10 ~ b*x9 + a*y9
  y11 ~ b*x10 + a*y10

  # Estimate the (residual) covariance between the variables
  x1 ~~ y1 # Covariance
  x2 ~~ y2
  x3 ~~ y3
  x4 ~~ y4
  x5 ~~ y5
  x6 ~~ y6
  x7 ~~ y7
  x8 ~~ y8
  x9 ~~ y9
  x10 ~~ y10
  x11 ~~ y11
  
  # Estimate the (residual) variance of the variables.
  x1 ~~ x1 # Variances
  y1 ~~ y1 
  x2 ~~ x2 # Residual variances
  y2 ~~ y2 
  x3 ~~ x3 
  y3 ~~ y3 
  x4 ~~ x4 
  y4 ~~ y4 
  x5 ~~ x5
  y5 ~~ y5
  x6 ~~ x6
  y6 ~~ y6
  x7 ~~ x7
  y7 ~~ y7 
  x8 ~~ x8 
  y8 ~~ y8 
  x9 ~~ x9 
  y9 ~~ y9 
  x10 ~~ x10
  y10 ~~ y10
  x11 ~~ x11
  y11 ~~ y11
  
  #intercepts
  x1 ~ 1
  y1 ~ 1
  x2 ~ 1
  y2 ~ 1
  x3 ~ 1
  y3 ~ 1
  x4 ~ 1
  y4 ~ 1
  x5 ~ 1
  y5 ~ 1
  x6 ~ 1
  y6 ~ 1
  x7 ~ 1
  y7 ~ 1
  x8 ~ 1
  y8 ~ 1
  x9 ~ 1
  y9 ~ 1
  x10 ~ 1
  y10 ~ 1
  x11 ~ 1
  y11 ~ 1
  
  
"

# L-BFGS-B / ,optim.method="BFGS" 

fitm1h1y1 <- lavaan(myModel, data = datalist_ori[[1]], missing = "fiml.x", meanstructure = T )
summary(fitm1h1y1, standardized = T)
fitm1h1y2 <- lavaan(myModel, data = datalist_ori[[2]], missing = "fiml.x", meanstructure = T)
summary(fitm1h1y2, standardized = T)
fitm1h1y3 <- lavaan(myModel, data = datalist_ori[[3]], missing = "fiml.x", meanstructure = T )
summary(fitm1h1y1, standardized = T)
fitm1h1y4 <- lavaan(myModel, data = datalist_ori[[4]], missing = "fiml.x", meanstructure = T)
summary(fitm1h1y2, standardized = T)

results[[1]] <- fitm1h1y1
results[[2]] <- fitm1h1y2
results[[3]] <- fitm1h1y3
results[[4]] <- fitm1h1y4

names(results) <- c("fitm1h1y1", "fitm1h1y2","fitm1h1y3","fitm1h1y4")

```

------------------------------------------------------------------------

### RI-CLPM

`r colorize("DONT FORGET TO SOLVE THE FITTING PROBLEMS", "red")`\
Changing optimizer seems to help a bit. Need to check what happens if we use all 11 waves. Update `r format(Sys.time(), '%B, %Y')`: `r colorize("We dont have any fitting problems anymore. I discovered typo in syntax", "green")`

-   We assume similar effect for men and women.\
-   We assume time-constant effects.\
-   We assume no structural changes (time trends).\
-   We include education as predictor for the RI/latent variable

```{r}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6 + 1*x7 + 1*x8 + 1*x9 + 1*x10 + 1*x11
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6 + 1*y7 + 1*y8 + 1*y9 + 1*y10 + 1*y11  
  
  RIx ~ e*oplx
  RIy ~ e*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wx6 ~ a*wx5 + b*wy5
  wx7 ~ a*wx6 + b*wy6
  wx8 ~ a*wx7 + b*wy7
  wx9 ~ a*wx8 + b*wy8
  wx10 ~ a*wx9 + b*wy9
  wx11 ~ a*wx10 + b*wy10
  
  wy2 ~ b*wx1 + a*wy1
  wy3 ~ b*wx2 + a*wy2
  wy4 ~ b*wx3 + a*wy3
  wy5 ~ b*wx4 + a*wy4
  wy6 ~ b*wx5 + a*wy5
  wy7 ~ b*wx6 + a*wy6
  wy8 ~ b*wx7 + a*wy7
  wy9 ~ b*wx8 + a*wy8
  wy10 ~ b*wx9 + a*wy9
  wy11 ~ b*wx10 + a*wy10

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'


fitm2h1y1 <- lavaan(RICLPM, data = datalist_ori[[1]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm2h1y1, standardized = T)
fitm2h1y2 <- lavaan(RICLPM, data = datalist_ori[[2]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm2h1y2, standardized = T)
fitm2h1y3 <- lavaan(RICLPM, data = datalist_ori[[3]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm2h1y1, standardized = T)
fitm2h1y4 <- lavaan(RICLPM, data = datalist_ori[[4]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm2h1y2, standardized = T)

results[[5]] <- fitm2h1y1
results[[6]] <- fitm2h1y2
results[[7]] <- fitm2h1y3
results[[8]] <- fitm2h1y4

names(results) <- c("fitm1h1y1", "fitm1h1y2","fitm1h1y3","fitm1h1y4","fitm2h1y1", "fitm2h1y2","fitm2h1y3","fitm2h1y4")
```

**Conclusions:**

------------------------------------------------------------------------

### SC-RI-CLPM

```{r}
SCCLPM <- '
  # Create between components 
  RIx =~ 1*x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11
  RIy =~ 1*y1 + y2 + y3 + y4 + y5 + y6 + y7 + y8 + y9 + y10 + y11  
  
  RIx ~ e*oplx
  RIy ~ e*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wx6 ~ a*wx5 + b*wy5
  wx7 ~ a*wx6 + b*wy6
  wx8 ~ a*wx7 + b*wy7
  wx9 ~ a*wx8 + b*wy8
  wx10 ~ a*wx9 + b*wy9
  wx11 ~ a*wx10 + b*wy10
  
  wy2 ~ b*wx1 + a*wy1
  wy3 ~ b*wx2 + a*wy2
  wy4 ~ b*wx3 + a*wy3
  wy5 ~ b*wx4 + a*wy4
  wy6 ~ b*wx5 + a*wy5
  wy7 ~ b*wx6 + a*wy6
  wy8 ~ b*wx7 + a*wy7
  wy9 ~ b*wx8 + a*wy8
  wy10 ~ b*wx9 + a*wy9
  wy11 ~ b*wx10 + a*wy10

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'


fitm3h1y1 <- lavaan(SCCLPM, data = datalist_ori[[1]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm3h1y1, standardized = T)
fitm3h1y2 <- lavaan(SCCLPM, data = datalist_ori[[2]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm3h1y2, standardized = T)
fitm3h1y3 <- lavaan(SCCLPM, data = datalist_ori[[3]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm3h1y1, standardized = T)
fitm3h1y4 <- lavaan(SCCLPM, data = datalist_ori[[4]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm3h1y2, standardized = T)

results[[9]] <- fitm3h1y1
results[[10]] <- fitm3h1y2
results[[11]] <- fitm3h1y3
results[[12]] <- fitm3h1y4
names(results)[9:12] <- c("fitm3h1y1", "fitm3h1y2","fitm3h1y3","fitm3h1y4")
```

**Conclusions:**

------------------------------------------------------------------------

### LT-RI-CLPM

```{r}

LTRICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6 + 1*x7 + 1*x8 + 1*x9 + 1*x10 + 1*x11
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6 + 1*y7 + 1*y8 + 1*y9 + 1*y10 + 1*y11
  
  RIx ~ e*oplx
  RIy ~ e*oply
  
  #Random slopes
  RIsx =~ 1*x1 + 2*x2 + 3*x3 + 4*x4 + 5*x5 + 6*x6 + 7*x7 + 8*x8 + 9*x9 + 10*x10 + 11*x11
  RIsy =~ 1*y1 + 2*y2 + 3*y3 + 4*y4 + 5*y5 + 6*y6 + 7*y7 + 8*y8 + 9*y9 + 10*y10 + 11*y11
  
  RIsx ~ f*oplx
  RIsy ~ f*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wx6 ~ a*wx5 + b*wy5
  wx7 ~ a*wx6 + b*wy6
  wx8 ~ a*wx7 + b*wy7
  wx9 ~ a*wx8 + b*wy8
  wx10 ~ a*wx9 + b*wy9
  wx11 ~ a*wx10 + b*wy10
  
  wy2 ~ b*wx1 + a*wy1
  wy3 ~ b*wx2 + a*wy2
  wy4 ~ b*wx3 + a*wy3
  wy5 ~ b*wx4 + a*wy4
  wy6 ~ b*wx5 + a*wy5
  wy7 ~ b*wx6 + a*wy6
  wy8 ~ b*wx7 + a*wy7
  wy9 ~ b*wx8 + a*wy8
  wy10 ~ b*wx9 + a*wy9
  wy11 ~ b*wx10 + a*wy10

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts and random slopes. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy #covariance intercepts: interpretation SELECTION
  RIsx ~~ RIsx
  RIsy ~~ RIsy
  RIsx ~~ RIsy #covariance slopes: interpretation COMMON CONTEXT
  RIx ~~ RIsx #covariance intercept/slope: interpretation regression to the mean
  RIy ~~ RIsy
  RIx ~~ RIsy #cross-covariance: interpretation  INFLUENCE? 
  RIy ~~ RIsx

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'
fitm4h1y1 <- lavaan(LTRICLPM , data = datalist_ori[[1]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm4h1y1, standardized = T)
fitm4h1y2 <- lavaan(LTRICLPM , data = datalist_ori[[2]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm4h1y2, standardized = T)
fitm4h1y3 <- lavaan(LTRICLPM , data = datalist_ori[[3]], missing = "fiml.x", meanstructure = T , int.ov.free = T)
summary(fitm4h1y1, standardized = T)
fitm4h1y4 <- lavaan(LTRICLPM , data = datalist_ori[[4]], missing = "fiml.x", meanstructure = T, int.ov.free = T)
summary(fitm4h1y2, standardized = T)

results[[13]] <- fitm4h1y1
results[[14]] <- fitm4h1y2
results[[15]] <- fitm4h1y3
results[[16]] <- fitm4h1y4

names(results)[13:16] <- c("fitm4h1y1", "fitm4h1y2","fitm4h1y3","fitm4h1y4")
```

------------------------------------------------------------------------

### Summary results hypo1

```{r, results='asis'}

#https://bookdown.org/yihui/rmarkdown-cookbook/kableextra.html
#https://haozhu233.github.io/kableExtra/awesome_table_in_html.html

library(knitr) #for kable/kables
library(kableExtra)


#retrieving data to show
#model 1
a <- parameterEstimates(results[[1]])[parameterEstimates(results[[1]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[1]])[parameterEstimates(results[[1]])$label=="b",][1,c(5,6,8)]
m1h1y1 <- rbind(a,b)


a <- parameterEstimates(results[[2]])[parameterEstimates(results[[2]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[2]])[parameterEstimates(results[[2]])$label=="b",][1,c(5,6,8)]
m1h1y2 <- rbind(a,b)

a <- parameterEstimates(results[[3]])[parameterEstimates(results[[3]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[3]])[parameterEstimates(results[[3]])$label=="b",][1,c(5,6,8)]
m1h1y3 <- rbind(a,b)

a <- parameterEstimates(results[[4]])[parameterEstimates(results[[4]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[4]])[parameterEstimates(results[[4]])$label=="b",][1,c(5,6,8)]
m1h1y4 <- rbind(a,b)

#model 2
a <- parameterEstimates(results[[5]])[parameterEstimates(results[[5]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[5]])[parameterEstimates(results[[5]])$label=="b",][1,c(5,6,8)]
m2h1y1 <- rbind(a,b)

a <- parameterEstimates(results[[6]])[parameterEstimates(results[[6]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[6]])[parameterEstimates(results[[6]])$label=="b",][1,c(5,6,8)]
m2h1y2 <- rbind(a,b)

a <- parameterEstimates(results[[7]])[parameterEstimates(results[[7]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[7]])[parameterEstimates(results[[7]])$label=="b",][1,c(5,6,8)]
m2h1y3 <- rbind(a,b)

a <- parameterEstimates(results[[8]])[parameterEstimates(results[[8]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[8]])[parameterEstimates(results[[8]])$label=="b",][1,c(5,6,8)]
m2h1y4 <- rbind(a,b)
#model 3
a <- parameterEstimates(results[[9]])[parameterEstimates(results[[9]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[9]])[parameterEstimates(results[[9]])$label=="b",][1,c(5,6,8)]
m3h1y1 <- rbind(a,b)

a <- parameterEstimates(results[[10]])[parameterEstimates(results[[10]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[10]])[parameterEstimates(results[[10]])$label=="b",][1,c(5,6,8)]
m3h1y2 <- rbind(a,b)

a <- parameterEstimates(results[[11]])[parameterEstimates(results[[11]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[11]])[parameterEstimates(results[[11]])$label=="b",][1,c(5,6,8)]
m3h1y3 <- rbind(a,b)

a <- parameterEstimates(results[[12]])[parameterEstimates(results[[12]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[12]])[parameterEstimates(results[[12]])$label=="b",][1,c(5,6,8)]
m3h1y4 <- rbind(a,b)

#model 4
a <- parameterEstimates(results[[13]])[parameterEstimates(results[[13]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[13]])[parameterEstimates(results[[13]])$label=="b",][1,c(5,6,8)]
m4h1y1 <- rbind(a,b)

a <- parameterEstimates(results[[14]])[parameterEstimates(results[[14]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[14]])[parameterEstimates(results[[14]])$label=="b",][1,c(5,6,8)]
m4h1y2 <- rbind(a,b)

a <- parameterEstimates(results[[15]])[parameterEstimates(results[[15]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[15]])[parameterEstimates(results[[15]])$label=="b",][1,c(5,6,8)]
m4h1y3 <- rbind(a,b)

a <- parameterEstimates(results[[16]])[parameterEstimates(results[[16]])$label=="a",][1,c(5,6,8)]
b <- parameterEstimates(results[[16]])[parameterEstimates(results[[16]])$label=="b",][1,c(5,6,8)]
m4h1y4 <- rbind(a,b)


#combine
#put deps under each other
m1deps <- rbind(m1h1y1, m1h1y2, m1h1y3, m1h1y4)
m2deps <- rbind(m2h1y1, m2h1y2, m2h1y3, m2h1y4)
m3deps <- rbind(m3h1y1, m3h1y2, m3h1y3, m3h1y4)
m4deps <- rbind(m4h1y1, m4h1y2, m4h1y3, m4h1y4)

m1deps
#put methods next to each other
h1 <- cbind(m1deps, m2deps, m3deps, m4deps)
h1
row.names(h1) <- NULL

paths <- rep(c("stability", "partner-effect"),2)
h1 <- cbind(paths,h1)
h1

hypo1 <- kbl(h1, booktabs=TRUE, digits=2, caption="Results Hypo1", align = "lcccccccccccc") %>%
  add_header_above(c(" ", "CLPM" = 3, "RI-CLPM" = 3, "SC-RI-CLPM" = 3, "LT-RI-CLPM" = 3)) %>%
  pack_rows(index=c("eu-integration"=2, "immigrants"=2, "euthanasia"=2, "income_diff"=2)) %>%
  kable_classic(full_width = F, html_font = "Cambria") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

hypo1

save_kable(hypo1, file="hypo1.html")
```

------------------------------------------------------------------------

### Conclusion hypo1

------------------------------------------------------------------------

## Results Hypo2 {.tabset .tabset-fade}

Hypo2: Women are more influenced by their (male) spouse than Men are influenced by their (female) spouse. 

### CLPM

```{r}
myModel <- "
  ### control for education
  x1 + x2 + x3 +x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11 ~ ex*oplx
  y1 + y2 + y3 +y4 + y5 + y6 + y7 + y8 + y9 + y10 + y11 ~ ey*oply
  
  ### Estimate the lagged effects
  x2 ~ ax*x1 + bx*y1
  x3 ~ ax*x2 + bx*y2
  x4 ~ ax*x3 + bx*y3
  x5 ~ ax*x4 + bx*y4
  x6 ~ ax*x5 + bx*y5
  x7 ~ ax*x6 + bx*y6
  x8 ~ ax*x7 + bx*y7
  x9 ~ ax*x8 + bx*y8
  x10 ~ ax*x9 + bx*y9
  x11 ~ ax*x10 + bx*y10
  
  y2 ~ by*x1 + ay*y1
  y3 ~ by*x2 + ay*y2
  y4 ~ by*x3 + ay*y3
  y5 ~ by*x4 + ay*y4
  y6 ~ by*x5 + ay*y5
  y7 ~ by*x6 + ay*y6
  y8 ~ by*x7 + ay*y7
  y9 ~ by*x8 + ay*y8
  y10 ~ by*x9 + ay*y9
  y11 ~ by*x10 + ay*y10

  # Estimate the (residual) covariance between the variables
  x1 ~~ y1 # Covariance
  x2 ~~ y2
  x3 ~~ y3
  x4 ~~ y4
  x5 ~~ y5
  x6 ~~ y6
  x7 ~~ y7
  x8 ~~ y8
  x9 ~~ y9
  x10 ~~ y10
  x11 ~~ y11
  
  # Estimate the (residual) variance of the variables.
  x1 ~~ x1 # Variances
  y1 ~~ y1 
  x2 ~~ x2 # Residual variances
  y2 ~~ y2 
  x3 ~~ x3 
  y3 ~~ y3 
  x4 ~~ x4 
  y4 ~~ y4 
  x5 ~~ x5
  y5 ~~ y5
  x6 ~~ x6
  y6 ~~ y6
  x7 ~~ x7
  y7 ~~ y7 
  x8 ~~ x8 
  y8 ~~ y8 
  x9 ~~ x9 
  y9 ~~ y9 
  x10 ~~ x10
  y10 ~~ y10
  x11 ~~ x11
  y11 ~~ y11
  
  #intercepts
  x1 ~ 1
  y1 ~ 1
  x2 ~ 1
  y2 ~ 1
  x3 ~ 1
  y3 ~ 1
  x4 ~ 1
  y4 ~ 1
  x5 ~ 1
  y5 ~ 1
  x6 ~ 1
  y6 ~ 1
  x7 ~ 1
  y7 ~ 1
  x8 ~ 1
  y8 ~ 1
  x9 ~ 1
  y9 ~ 1
  x10 ~ 1
  y10 ~ 1
  x11 ~ 1
  y11 ~ 1
  
  dif1 := ax - ay
  dif2 := bx - by
  dif3 := ex - ey
  
  
"


#Estimate models a bit faster:

estimate <- function(x) lavaan(myModel, data=x, missing = "fiml.x", meanstructure = T )
library(future.apply)
plan(multisession)

results_temp <- future_lapply(datalist_ori, estimate)
summary(results_temp[[1]])
results[[17]] <- results_temp[[1]]
results[[18]] <- results_temp[[2]]
results[[19]] <- results_temp[[3]]
results[[20]] <- results_temp[[4]]

names(results)[17:20] <- c("fitm1h2y1", "fitm1h2y2","fitm1h2y3","fitm1h2y4")

```

------------------------------------------------------------------------

### RI-CLPM

```{r}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6 + 1*x7 + 1*x8 + 1*x9 + 1*x10 + 1*x11
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6 + 1*y7 + 1*y8 + 1*y9 + 1*y10 + 1*y11  
  
  RIx ~ ex*oplx
  RIy ~ ey*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

  # Estimate the lagged effects between the within-person centered variables.
  x2 ~ ax*x1 + bx*y1
  x3 ~ ax*x2 + bx*y2
  x4 ~ ax*x3 + bx*y3
  x5 ~ ax*x4 + bx*y4
  x6 ~ ax*x5 + bx*y5
  x7 ~ ax*x6 + bx*y6
  x8 ~ ax*x7 + bx*y7
  x9 ~ ax*x8 + bx*y8
  x10 ~ ax*x9 + bx*y9
  x11 ~ ax*x10 + bx*y10
  
  y2 ~ by*x1 + ay*y1
  y3 ~ by*x2 + ay*y2
  y4 ~ by*x3 + ay*y3
  y5 ~ by*x4 + ay*y4
  y6 ~ by*x5 + ay*y5
  y7 ~ by*x6 + ay*y6
  y8 ~ by*x7 + ay*y7
  y9 ~ by*x8 + ay*y8
  y10 ~ by*x9 + ay*y9
  y11 ~ by*x10 + ay*y10

  dif1 := ax - ay
  dif2 := bx - by
  dif3 := ex - ey

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'


#Estimate models a bit faster:

estimate <- function(x) lavaan(RICLPM, data=x, missing = "fiml.x", meanstructure = T )
library(future.apply)
plan(multisession)

results_temp <- future_lapply(datalist_ori, estimate)
summary(results_temp[[4]])

results[[21]] <- results_temp[[1]]
results[[22]] <- results_temp[[2]]
results[[23]] <- results_temp[[3]]
results[[24]] <- results_temp[[4]]

names(results)[21:24] <- c("fitm2h2y1", "fitm2h2y2","fitm2h2y3","fitm2h2y4")
```

------------------------------------------------------------------------

### SC-RI-CLPM

```{r}

SCCLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + x2 + x3 + x4 + x5 + x6 + x7 + x8 + x9 + x10 + x11
  RIy =~ 1*y1 + y2 + y3 + y4 + y5 + y6 + y7 + y8 + y9 + y10 + y11  
  
  RIx ~ ex*oplx
  RIy ~ ey*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

  # Estimate the lagged effects between the within-person centered variables.
  x2 ~ ax*x1 + bx*y1
  x3 ~ ax*x2 + bx*y2
  x4 ~ ax*x3 + bx*y3
  x5 ~ ax*x4 + bx*y4
  x6 ~ ax*x5 + bx*y5
  x7 ~ ax*x6 + bx*y6
  x8 ~ ax*x7 + bx*y7
  x9 ~ ax*x8 + bx*y8
  x10 ~ ax*x9 + bx*y9
  x11 ~ ax*x10 + bx*y10
  
  y2 ~ by*x1 + ay*y1
  y3 ~ by*x2 + ay*y2
  y4 ~ by*x3 + ay*y3
  y5 ~ by*x4 + ay*y4
  y6 ~ by*x5 + ay*y5
  y7 ~ by*x6 + ay*y6
  y8 ~ by*x7 + ay*y7
  y9 ~ by*x8 + ay*y8
  y10 ~ by*x9 + ay*y9
  y11 ~ by*x10 + ay*y10

  dif1 := ax - ay
  dif2 := bx - by
  dif3 := ex - ey

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'


#Estimate models a bit faster:

estimate <- function(x) lavaan(SCCLPM, data=x, missing = "fiml.x", meanstructure = T )
library(future.apply)
plan(multisession)

results_temp <- future_lapply(datalist_ori, estimate)
summary(results_temp[[4]])

results[[25]] <- results_temp[[1]]
results[[26]] <- results_temp[[2]]
results[[27]] <- results_temp[[3]]
results[[28]] <- results_temp[[4]]

names(results)[25:28] <- c("fitm3h2y1", "fitm3h2y2","fitm3h2y3","fitm3h2y4")
```

------------------------------------------------------------------------

### LT-RI-CLPM

```{r}

LTRICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6 + 1*x7 + 1*x8 + 1*x9 + 1*x10 + 1*x11
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6 + 1*y7 + 1*y8 + 1*y9 + 1*y10 + 1*y11
  
  RIx ~ ex*oplx
  RIy ~ ey*oply
  
  #Random slopes
  RIsx =~ 1*x1 + 2*x2 + 3*x3 + 4*x4 + 5*x5 + 6*x6 + 7*x7 + 8*x8 + 9*x9 + 10*x10 + 11*x11
  RIsy =~ 1*y1 + 2*y2 + 3*y3 + 4*y4 + 5*y5 + 6*y6 + 7*y7 + 8*y8 + 9*y9 + 10*y10 + 11*y11
  
  RIsx ~ fx*oplx
  RIsy ~ fy*oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  wx7 =~ 1*x7
  wx8 =~ 1*x8 
  wx9 =~ 1*x9
  wx10 =~ 1*x10
  wx11 =~ 1*x11
 
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6
  wy7 =~ 1*y7
  wy8 =~ 1*y8
  wy9 =~ 1*y9
  wy10 =~ 1*y10
  wy11 =~ 1*y11

 # Estimate the lagged effects between the within-person centered variables.
  x2 ~ ax*x1 + bx*y1
  x3 ~ ax*x2 + bx*y2
  x4 ~ ax*x3 + bx*y3
  x5 ~ ax*x4 + bx*y4
  x6 ~ ax*x5 + bx*y5
  x7 ~ ax*x6 + bx*y6
  x8 ~ ax*x7 + bx*y7
  x9 ~ ax*x8 + bx*y8
  x10 ~ ax*x9 + bx*y9
  x11 ~ ax*x10 + bx*y10
  
  y2 ~ by*x1 + ay*y1
  y3 ~ by*x2 + ay*y2
  y4 ~ by*x3 + ay*y3
  y5 ~ by*x4 + ay*y4
  y6 ~ by*x5 + ay*y5
  y7 ~ by*x6 + ay*y6
  y8 ~ by*x7 + ay*y7
  y9 ~ by*x8 + ay*y8
  y10 ~ by*x9 + ay*y9
  y11 ~ by*x10 + ay*y10

  dif1 := ax - ay
  dif2 := bx - by
  dif3 := ex - ey
  dif4 := fx - fy

  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  wx7 ~~ wy7
  wx8 ~~ wy8
  wx9 ~~ wy9
  wx10 ~~ wy10
  wx11 ~~ wy11
  
  # Estimate the variance and covariance of the random intercepts and random slopes. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy #covariance intercepts: interpretation SELECTION
  RIsx ~~ RIsx
  RIsy ~~ RIsy
  RIsx ~~ RIsy #covariance slopes: interpretation COMMON CONTEXT
  RIx ~~ RIsx #covariance intercept/slope: interpretation regression to the mean
  RIy ~~ RIsy
  RIx ~~ RIsy #cross-covariance: interpretation  INFLUENCE? 
  RIy ~~ RIsx

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
  wx7 ~~ wx7
  wy7 ~~ wy7 
  wx8 ~~ wx8 
  wy8 ~~ wy8 
  wx9 ~~ wx9 
  wy9 ~~ wy9 
  wx10 ~~ wx10
  wy10 ~~ wy10
  wx11 ~~ wx11
  wy11 ~~ wy11
'
#Estimate models a bit faster:

estimate <- function(x) lavaan(LTRICLPM, data=x, missing = "fiml.x", meanstructure = T )
library(future.apply)
plan(multisession)

results_temp <- future_lapply(datalist_ori, estimate)
summary(results_temp[[4]])

results[[29]] <- results_temp[[1]]
results[[30]] <- results_temp[[2]]
results[[31]] <- results_temp[[3]]
results[[32]] <- results_temp[[4]]

names(results)[29:32] <- c("fitm4h2y1", "fitm4h2y2","fitm4h2y3","fitm4h2y4")
```

------------------------------------------------------------------------

### Summary results Hypo2

```{r, results='asis'}

#https://bookdown.org/yihui/rmarkdown-cookbook/kableextra.html
#https://haozhu233.github.io/kableExtra/awesome_table_in_html.html

library(knitr) #for kable/kables
library(kableExtra)


#retrieving data to show
#model 1
ax <- parameterEstimates(results[[17]])[parameterEstimates(results[[17]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[17]])[parameterEstimates(results[[17]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[17]])[parameterEstimates(results[[17]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[17]])[parameterEstimates(results[[17]])$label=="by",][1,c(5,6,8)]
m1h2y1 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[18]])[parameterEstimates(results[[18]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[18]])[parameterEstimates(results[[18]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[18]])[parameterEstimates(results[[18]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[18]])[parameterEstimates(results[[18]])$label=="by",][1,c(5,6,8)]
m1h2y2 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[19]])[parameterEstimates(results[[19]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[19]])[parameterEstimates(results[[19]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[19]])[parameterEstimates(results[[19]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[19]])[parameterEstimates(results[[19]])$label=="by",][1,c(5,6,8)]
m1h2y3 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[20]])[parameterEstimates(results[[20]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[20]])[parameterEstimates(results[[20]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[20]])[parameterEstimates(results[[20]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[20]])[parameterEstimates(results[[20]])$label=="by",][1,c(5,6,8)]
m1h2y4 <- rbind(ax,ay,bx,by)

#model 2
ax <- parameterEstimates(results[[21]])[parameterEstimates(results[[21]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[21]])[parameterEstimates(results[[21]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[21]])[parameterEstimates(results[[21]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[21]])[parameterEstimates(results[[21]])$label=="by",][1,c(5,6,8)]
m2h2y1 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[22]])[parameterEstimates(results[[22]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[22]])[parameterEstimates(results[[22]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[22]])[parameterEstimates(results[[22]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[22]])[parameterEstimates(results[[22]])$label=="by",][1,c(5,6,8)]
m2h2y2 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[23]])[parameterEstimates(results[[23]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[23]])[parameterEstimates(results[[23]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[23]])[parameterEstimates(results[[23]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[23]])[parameterEstimates(results[[23]])$label=="by",][1,c(5,6,8)]
m2h2y3 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[24]])[parameterEstimates(results[[24]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[24]])[parameterEstimates(results[[24]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[24]])[parameterEstimates(results[[24]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[24]])[parameterEstimates(results[[24]])$label=="by",][1,c(5,6,8)]
m2h2y4 <- rbind(ax,ay,bx,by)

#model 3
ax <- parameterEstimates(results[[25]])[parameterEstimates(results[[25]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[25]])[parameterEstimates(results[[25]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[25]])[parameterEstimates(results[[25]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[25]])[parameterEstimates(results[[25]])$label=="by",][1,c(5,6,8)]
m3h2y1 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[26]])[parameterEstimates(results[[26]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[26]])[parameterEstimates(results[[26]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[26]])[parameterEstimates(results[[26]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[26]])[parameterEstimates(results[[26]])$label=="by",][1,c(5,6,8)]
m3h2y2 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[27]])[parameterEstimates(results[[27]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[27]])[parameterEstimates(results[[27]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[27]])[parameterEstimates(results[[27]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[27]])[parameterEstimates(results[[27]])$label=="by",][1,c(5,6,8)]
m3h2y3 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[28]])[parameterEstimates(results[[28]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[28]])[parameterEstimates(results[[28]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[28]])[parameterEstimates(results[[28]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[28]])[parameterEstimates(results[[28]])$label=="by",][1,c(5,6,8)]
m3h2y4 <- rbind(ax,ay,bx,by)

#model 4
ax <- parameterEstimates(results[[29]])[parameterEstimates(results[[29]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[29]])[parameterEstimates(results[[29]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[29]])[parameterEstimates(results[[29]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[29]])[parameterEstimates(results[[29]])$label=="by",][1,c(5,6,8)]
m4h2y1 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[30]])[parameterEstimates(results[[30]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[30]])[parameterEstimates(results[[30]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[30]])[parameterEstimates(results[[30]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[30]])[parameterEstimates(results[[30]])$label=="by",][1,c(5,6,8)]
m4h2y2 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[31]])[parameterEstimates(results[[31]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[31]])[parameterEstimates(results[[31]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[31]])[parameterEstimates(results[[31]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[31]])[parameterEstimates(results[[31]])$label=="by",][1,c(5,6,8)]
m4h2y3 <- rbind(ax,ay,bx,by)

ax <- parameterEstimates(results[[32]])[parameterEstimates(results[[32]])$label=="ax",][1,c(5,6,8)]
bx <- parameterEstimates(results[[32]])[parameterEstimates(results[[32]])$label=="bx",][1,c(5,6,8)]
ay <- parameterEstimates(results[[32]])[parameterEstimates(results[[32]])$label=="ay",][1,c(5,6,8)]
by <- parameterEstimates(results[[32]])[parameterEstimates(results[[32]])$label=="by",][1,c(5,6,8)]
m4h2y4 <- rbind(ax,ay,bx,by)

#combine
#put deps under each other
m1deps <- rbind(m1h2y1, m1h2y2, m1h2y3, m1h2y4)
m2deps <- rbind(m2h2y1, m2h2y2, m2h2y3, m2h2y4)
m3deps <- rbind(m3h2y1, m3h2y2, m3h2y3, m3h2y4)
m4deps <- rbind(m4h2y1, m4h2y2, m4h2y3, m4h2y4)

#put methods next to each other
h2 <- cbind(m1deps, m2deps, m3deps, m4deps)
row.names(h2) <- NULL

paths <- rep(c("Men:stability", "Women:stability", "Men:partner-effect", "Women:partner-effect"),2)
h2 <- cbind(paths,h2)
h2

hypo2 <- kbl(h2, booktabs=TRUE, digits=2, caption="Results Hypo2", align = "lcccccccccccc") %>%
  add_header_above(c(" ", "CLPM" = 3, "RI-CLPM" = 3, "SC-RI-CLPM" = 3, "LT-RI-CLPM" = 3)) %>%
  pack_rows(index=c("eu-integration"=4, "immigrants"=4, "euthanasia"=4, "income_diff"=4)) %>%
  kable_classic(full_width = F, html_font = "Cambria") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  column_spec(5:7, color = "white", background = "green")

hypo2

save_kable(hypo2, file="hypo2.html")
```

------------------------------------------------------------------------

### Conclusion Hypo2

------------------------------------------------------------------------

## Results Hypo3 {.tabset .tabset-fade}

Hypo3: The partner with the highest education exerts most influence. 

In lavaan it is not possible to include interaction effects directly with latent variables. Strategy 1 is a two-step approach. Strategy 2 is a multi-group approach.

If have chosen for the multi-group approach. If the education of the partners differed with more than 1 year I treat them as different:

```{r, eval=FALSE}
table(dat$oplgroup, useNA = "always")
```

### CLPM  

### RI-CLPM  

### SC-RI-CLPM  

### LT-RI-CLPM  

### Summary results Hypo3  

### Conclusion Hypo3

```{r, eval=FALSE}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6
  
  RIx ~ oplx
  RIy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ c(ag1, ag2, ag3)*wx1 + c(bxg1, bxg2, bxg3)*wy1
  wx3 ~ c(ag1, ag2, ag3)*wx2 + c(bxg1, bxg2, bxg3)*wy2
  wx4 ~ c(ag1, ag2, ag3)*wx3 + c(bxg1, bxg2, bxg3)*wy3
  wx5 ~ c(ag1, ag2, ag3)*wx4 + c(bxg1, bxg2, bxg3)*wy4
  wx6 ~ c(ag1, ag2, ag3)*wx5 + c(bxg1, bxg2, bxg3)*wy5
  
  wy2 ~ c(byg1, byg2, byg3)*wx1 + c(ag1, ag2, ag3)*wy1
  wy3 ~ c(byg1, byg2, byg3)*wx2 + c(ag1, ag2, ag3)*wy2
  wy4 ~ c(byg1, byg2, byg3)*wx3 + c(ag1, ag2, ag3)*wy3
  wy5 ~ c(byg1, byg2, byg3)*wx4 + c(ag1, ag2, ag3)*wy4
  wy6 ~ c(byg1, byg2, byg3)*wx5 + c(ag1, ag2, ag3)*wy6
  


  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
'
RICLPM.fit <- lavaan(RICLPM, data = dat, missing = 'ml.x', meanstructure = T, int.ov.free = T, optim.method="BFGS", group="oplgroup") 
summary(RICLPM.fit, standardized = T)
```

------------------------------------------------------------------------



```{r, eval=FALSE}
RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5 + 1*x6
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5 + 1*y6
  
  RIx ~ oplx
  RIy ~ oply
  
  #Random slopes
  RIsx =~ 1*x1 + 2*x2 + 3*x3 + 4*x4 + 5*x5 + 6*x6
  RIsy =~ 1*y1 + 2*y2 + 3*y3 + 4*y4 + 5*y5 + 6*y6
  
  RIsx ~ oplx
  RIsy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wx6 =~ 1*x6
  
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5
  wy6 =~ 1*y6

# Estimate the lagged effects between the within-person centered variables.
  wx2 ~ c(ag1, ag2, ag3)*wx1 + c(bxg1, bxg2, bxg3)*wy1
  wx3 ~ c(ag1, ag2, ag3)*wx2 + c(bxg1, bxg2, bxg3)*wy2
  wx4 ~ c(ag1, ag2, ag3)*wx3 + c(bxg1, bxg2, bxg3)*wy3
  wx5 ~ c(ag1, ag2, ag3)*wx4 + c(bxg1, bxg2, bxg3)*wy4
  wx6 ~ c(ag1, ag2, ag3)*wx5 + c(bxg1, bxg2, bxg3)*wy5
  
  wy2 ~ c(byg1, byg2, byg3)*wx1 + c(ag1, ag2, ag3)*wy1
  wy3 ~ c(byg1, byg2, byg3)*wx2 + c(ag1, ag2, ag3)*wy2
  wy4 ~ c(byg1, byg2, byg3)*wx3 + c(ag1, ag2, ag3)*wy3
  wy5 ~ c(byg1, byg2, byg3)*wx4 + c(ag1, ag2, ag3)*wy4
  wy6 ~ c(byg1, byg2, byg3)*wx5 + c(ag1, ag2, ag3)*wy6
  
  # Estimate the (residual) covariance between the within-person centered variables
  wx1 ~~ wy1 # Covariance
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  wx6 ~~ wy6
  
  # Estimate the variance and covariance of the random intercepts and random slopes. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy #covariance intercepts: interpretation SELECTION
  RIsx ~~ RIsx
  RIsy ~~ RIsy
  RIsx ~~ RIsy #covariance slopes: interpretation COMMON CONTEXT
  RIx ~~ RIsx #covariance intercept/slope: interpretation regression to the mean
  RIy ~~ RIsy
  RIx ~~ RIsy #cross-covariance: interpretation  INFLUENCE? 
  RIy ~~ RIsx

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
  wx6 ~~ wx6
  wy6 ~~ wy6
'
RICLPM.fit <- lavaan(RICLPM, data = dat, missing = 'ml.x', meanstructure = T, int.ov.free = T, optim.method="BFGS", group= "oplgroup") 
summary(RICLPM.fit, standardized = T)
```

------------------------------------------------------------------------

## Robustness check {.tabset .tabset-fade}

### Initial disagreement or not  

Select on couples who disagree


```{r, eval=FALSE}
hist(dat$x1-dat$y1)
table(dat$x1-dat$y1, useNA="always")

#dat$x1-dat$y1
dat_sel <- dat[abs(dat$x1-dat$y1)>1 & !is.na(dat$x1-dat$y1),]

RICLPM <- '
  # Create between components (random intercepts)
  RIx =~ 1*x1 + 1*x2 + 1*x3 + 1*x4 + 1*x5
  RIy =~ 1*y1 + 1*y2 + 1*y3 + 1*y4 + 1*y5
  
  RIx ~ oplx
  RIy ~ oply
  
  # Create within-person centered variables
  wx1 =~ 1*x1
  wx2 =~ 1*x2
  wx3 =~ 1*x3 
  wx4 =~ 1*x4
  wx5 =~ 1*x5
  wy1 =~ 1*y1
  wy2 =~ 1*y2
  wy3 =~ 1*y3
  wy4 =~ 1*y4
  wy5 =~ 1*y5

  # Estimate the lagged effects between the within-person centered variables.
  wx2 ~ a*wx1 + b*wy1
  wx3 ~ a*wx2 + b*wy2
  wx4 ~ a*wx3 + b*wy3
  wx5 ~ a*wx4 + b*wy4
  wy2 ~ c*wx1 + d*wy1
  wy3 ~ c*wx2 + d*wy2
  wy4 ~ c*wx3 + d*wy3
  wy5 ~ c*wx4 + d*wy4

  # Estimate the covariance between the within-person centered variables at the first wave. 
  wx1 ~~ wy1 # Covariance
  
  # Estimate the covariances between the residuals of the within-person centered variables (the innovations).
  wx2 ~~ wy2
  wx3 ~~ wy3
  wx4 ~~ wy4
  wx5 ~~ wy5
  
  # Estimate the variance and covariance of the random intercepts. 
  RIx ~~ RIx
  RIy ~~ RIy
  RIx ~~ RIy

  # Estimate the (residual) variance of the within-person centered variables.
  wx1 ~~ wx1 # Variances
  wy1 ~~ wy1 
  wx2 ~~ wx2 # Residual variances
  wy2 ~~ wy2 
  wx3 ~~ wx3 
  wy3 ~~ wy3 
  wx4 ~~ wx4 
  wy4 ~~ wy4 
  wx5 ~~ wx5
  wy5 ~~ wy5
'
RICLPM.fit <- lavaan(RICLPM, data = dat_sel, missing = 'ml.x', meanstructure = T, int.ov.free = T) 
summary(RICLPM.fit, standardized = T)
```

------------------------------------------------------------------------

## References
